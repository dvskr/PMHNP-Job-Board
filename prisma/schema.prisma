generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model Job {
  id                  String       @id @default(uuid())
  title               String
  slug                String?      @unique
  employer            String
  location            String
  jobType             String?      @map("job_type")
  mode                String?
  description         String
  descriptionSummary  String?      @map("description_summary")
  salaryRange         String?      @map("salary_range")
  minSalary           Int?         @map("min_salary")
  maxSalary           Int?         @map("max_salary")
  salaryPeriod        String?      @map("salary_period")
  city                String?
  state               String?
  stateCode           String?      @map("state_code")
  country             String?      @default("US")
  isRemote            Boolean      @default(false) @map("is_remote")
  isHybrid            Boolean      @default(false) @map("is_hybrid")
  normalizedMinSalary Int?         @map("normalized_min_salary")
  normalizedMaxSalary Int?         @map("normalized_max_salary")
  salaryIsEstimated   Boolean      @default(false) @map("salary_is_estimated")
  salaryConfidence    Float?       @map("salary_confidence")
  displaySalary       String?      @map("display_salary")
  applyLink           String       @map("apply_link")
  isFeatured          Boolean      @default(false) @map("is_featured")
  isPublished         Boolean      @default(true) @map("is_published")
  isVerifiedEmployer  Boolean      @default(false) @map("is_verified_employer")
  sourceType          String?      @map("source_type")
  sourceProvider      String?      @map("source_provider")
  externalId          String?      @map("external_id")
  viewCount           Int          @default(0) @map("view_count")
  applyClickCount     Int          @default(0) @map("apply_click_count")
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @updatedAt @map("updated_at")
  expiresAt           DateTime?    @map("expires_at")
  companyId           String?      @map("company_id")
  originalPostedAt    DateTime?    @map("original_posted_at")
  applyClicks         ApplyClick[]
  jobApplications     JobApplication[]
  employerJobs        EmployerJob?
  company             Company?     @relation(fields: [companyId], references: [id])

  @@index([isPublished])
  @@index([isFeatured])
  @@index([location])
  @@index([createdAt(sort: Desc)])
  @@index([minSalary, maxSalary])
  @@index([state])
  @@index([isRemote])
  @@index([companyId])
  @@index([slug])
  @@index([externalId, sourceProvider])
  @@map("jobs")
}

model EmailLead {
  id               String     @id @default(cuid())
  email            String     @unique
  preferences      Json       @default("{}")
  source           String?
  isSubscribed     Boolean    @default(true) @map("is_subscribed")
  newsletterOptIn  Boolean    @default(false) @map("newsletter_opt_in")
  unsubscribeToken String     @unique @default(cuid()) @map("unsubscribe_token")
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")
  jobAlerts        JobAlert[]

  @@index([email])
  @@index([unsubscribeToken])
  @@map("email_leads")
}

model JobAlert {
  id         String    @id @default(cuid())
  email      String
  name       String?
  keyword    String?
  location   String?
  mode       String?
  jobType    String?   @map("job_type")
  minSalary  Int?      @map("min_salary")
  maxSalary  Int?      @map("max_salary")
  frequency  String    @default("weekly")
  isActive   Boolean   @default(true) @map("is_active")
  lastSentAt DateTime? @map("last_sent_at")
  token      String    @unique @default(cuid())
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  emailLead  EmailLead @relation(fields: [email], references: [email])

  @@index([email])
  @@index([token])
  @@index([isActive])
  @@map("job_alerts")
}

model EmployerJob {
  id                  String       @id @default(uuid())
  employerName        String       @map("employer_name")
  contactEmail        String       @map("contact_email")
  companyLogoUrl      String?      @map("company_logo_url")
  companyDescription  String?      @map("company_description")
  companyWebsite      String?      @map("company_website")
  jobId               String       @unique @map("job_id")
  editToken           String       @unique @map("edit_token")
  dashboardToken      String       @unique @default(cuid()) @map("dashboard_token")
  paymentStatus       String       @map("payment_status")
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @updatedAt @map("updated_at")
  expiryWarningSentAt DateTime?    @map("expiry_warning_sent_at")
  userId              String?      @map("user_id")
  job                 Job          @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user                UserProfile? @relation(fields: [userId], references: [supabaseId])

  @@index([userId])
  @@index([editToken])
  @@index([contactEmail])
  @@index([dashboardToken])
  @@map("employer_jobs")
}

model SiteStat {
  id               String   @id @default(uuid())
  totalJobs        Int      @default(0) @map("total_jobs")
  totalSubscribers Int      @default(0) @map("total_subscribers")
  totalCompanies   Int      @default(0) @map("total_companies")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@map("site_stats")
}

model JobDraft {
  id          String   @id @default(cuid())
  email       String
  formData    Json     @map("form_data")
  resumeToken String   @unique @default(cuid()) @map("resume_token")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  expiresAt   DateTime @map("expires_at")

  @@index([email])
  @@index([resumeToken])
  @@map("job_drafts")
}

model Company {
  id             String   @id @default(uuid())
  name           String   @unique
  normalizedName String   @unique @map("normalized_name")
  aliases        String[] @default([])
  logoUrl        String?  @map("logo_url")
  website        String?
  description    String?
  jobCount       Int      @default(0) @map("job_count")
  isVerified     Boolean  @default(false) @map("is_verified")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  jobs           Job[]

  @@index([normalizedName])
  @@index([isVerified])
  @@map("companies")
}

model SourceStats {
  id               String   @id @default(uuid())
  source           String
  date             DateTime @db.Date
  jobsFetched      Int      @default(0) @map("jobs_fetched")
  jobsAdded        Int      @default(0) @map("jobs_added")
  jobsDuplicate    Int      @default(0) @map("jobs_duplicate")
  jobsExpired      Int      @default(0) @map("jobs_expired")
  avgQualityScore  Float?   @map("avg_quality_score")
  totalViews       Int      @default(0) @map("total_views")
  totalApplyClicks Int      @default(0) @map("total_apply_clicks")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@unique([source, date])
  @@index([source])
  @@index([date])
  @@map("source_stats")
}

model ApplyClick {
  id        String   @id @default(uuid())
  jobId     String   @map("job_id")
  source    String?
  timestamp DateTime @default(now())
  sessionId String?  @map("session_id")
  referrer  String?
  userAgent String?  @map("user_agent")
  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([source])
  @@index([timestamp])
  @@map("apply_clicks")
}

model EmployerLead {
  id              String    @id @default(uuid())
  companyName     String    @map("company_name")
  contactName     String?   @map("contact_name")
  contactEmail    String?   @map("contact_email")
  contactTitle    String?   @map("contact_title")
  website         String?
  linkedInUrl     String?   @map("linkedin_url")
  notes           String?
  status          String    @default("prospect")
  source          String?
  lastContactedAt DateTime? @map("last_contacted_at")
  nextFollowUpAt  DateTime? @map("next_follow_up_at")
  jobsPosted      Int       @default(0) @map("jobs_posted")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@index([status])
  @@index([companyName])
  @@map("employer_leads")
}

model UserProfile {
  id                String        @id @default(cuid())
  supabaseId        String        @unique @map("supabase_id")
  email             String        @unique
  role              String        @default("job_seeker")
  firstName         String?       @map("first_name")
  lastName          String?       @map("last_name")
  phone             String?
  company           String?
  resumeUrl         String?       @map("resume_url")
  avatarUrl         String?       @map("avatar_url")

  // PMHNP-specific professional fields
  headline          String?       @map("headline")
  yearsExperience   Int?          @map("years_experience")
  certifications    String?       @map("certifications")
  licenseStates     String?       @map("license_states")
  specialties       String?       @map("specialties")
  bio               String?       @map("bio")
  linkedinUrl       String?       @map("linkedin_url")

  // Job preferences
  preferredWorkMode String?       @map("preferred_work_mode")
  preferredJobType  String?       @map("preferred_job_type")
  desiredSalaryMin  Int?          @map("desired_salary_min")
  desiredSalaryMax  Int?          @map("desired_salary_max")
  desiredSalaryType String?       @map("desired_salary_type")
  availableDate     DateTime?     @map("available_date")

  // Visibility
  openToOffers      Boolean       @default(true) @map("open_to_offers")
  profileVisible    Boolean       @default(true) @map("profile_visible")

  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")
  employerJobs      EmployerJob[]
  jobApplications   JobApplication[]

  @@index([supabaseId])
  @@index([email])
  @@index([profileVisible, openToOffers, role])
  @@map("user_profiles")
}

model JobApplication {
  id        String      @id @default(cuid())
  userId    String      @map("user_id")
  jobId     String      @map("job_id")
  sourceUrl String?     @map("source_url")
  appliedAt DateTime    @default(now()) @map("applied_at")
  user      UserProfile @relation(fields: [userId], references: [supabaseId], onDelete: Cascade)
  job       Job         @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([userId, jobId])
  @@index([userId])
  @@index([jobId])
  @@map("job_applications")
}

model ProfileView {
  id          String   @id @default(cuid())
  viewerId    String   @map("viewer_id")
  candidateId String   @map("candidate_id")
  viewedAt    DateTime @default(now()) @map("viewed_at")

  @@unique([viewerId, candidateId])
  @@index([viewerId])
  @@index([candidateId])
  @@map("profile_views")
}

model BlogPost {
  id              String   @id @default(uuid())
  title           String
  slug            String   @unique
  content         String
  metaDescription String?  @map("meta_description")
  targetKeyword   String?  @map("target_keyword")
  category        String
  status          String   @default("draft")
  publishDate     DateTime? @map("publish_date")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@index([status, publishDate(sort: Desc)])
  @@index([slug])
  @@index([category])
  @@map("blog_posts")
}
