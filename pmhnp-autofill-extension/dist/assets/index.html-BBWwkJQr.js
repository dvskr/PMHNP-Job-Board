import{r as a,j as e,R as k,a as R}from"./global-UAmyxp-C.js";import{e as _,f as N}from"./constants-BdnQFqPF.js";async function o(r){try{const t=await chrome.runtime.sendMessage(r);if(t!=null&&t.error)throw new Error(t.error);return t}catch(t){throw console.error(`[PMHNP] Message to background failed (${r.type}):`,t),t}}async function A(r){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id))throw new Error("No active tab found");const s=await chrome.tabs.sendMessage(t.id,r);if(s!=null&&s.error)throw new Error(s.error);return s}catch(t){throw console.error(`[PMHNP] Message to content script failed (${r.type}):`,t),t}}function E(){return o({type:"LOGIN"})}function P(){return o({type:"LOGOUT"})}function T(){return o({type:"GET_AUTH_STATE"})}function I(){return o({type:"REFRESH_PROFILE"})}function w(){return o({type:"GET_PROFILE_READINESS"})}function M(){return A({type:"IS_APPLICATION_PAGE"})}function C(){return A({type:"START_AUTOFILL"})}function F(){const[r,t]=a.useState("loading"),[s,g]=a.useState(null),[l,x]=a.useState(null),[i,m]=a.useState(null),[p,b]=a.useState(!1),[u,h]=a.useState(""),[c,y]=a.useState(!1),f=a.useCallback(async()=>{try{const n=await T();if(g(n),!n.isLoggedIn){t("logged_out");return}try{const d=await w();x(d)}catch{}try{const d=await M();m(d),t(d.isApplication?"on_application":"logged_in")}catch{t("logged_in")}}catch{t("logged_out")}},[]);a.useEffect(()=>{f()},[f]);const S=async()=>{try{await E(),await f()}catch(n){console.error("Login failed:",n)}},j=async()=>{await P(),g(null),x(null),m(null),t("logged_out")},v=async()=>{y(!0);try{await I();const n=await w();x(n)}catch(n){console.error("Refresh failed:",n)}finally{y(!1)}},L=async()=>{b(!0),h("");try{await C(),h("Autofill complete! Open the review sidebar to verify.")}catch(n){h(`Autofill failed: ${n instanceof Error?n.message:"Unknown error"}`)}finally{b(!1)}};return r==="loading"?e.jsx("div",{className:"flex items-center justify-center min-h-[200px] bg-navy",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-teal border-t-transparent"})}):e.jsxs("div",{className:"bg-navy min-h-[200px] p-4 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-teal flex items-center justify-center",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 3l1.912 5.813h6.088l-4.956 3.574 1.912 5.813L12 14.626l-4.956 3.574 1.912-5.813L4 8.813h6.088z"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-white leading-tight",children:"PMHNP Hiring"}),e.jsx("p",{className:"text-[10px] text-text-secondary leading-tight",children:"Autofill Agent"})]})]}),r==="logged_out"&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center gap-4 py-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Autofill PMHNP job applications in seconds"}),e.jsx("button",{onClick:S,className:"w-full py-2.5 px-4 bg-teal hover:bg-teal-hover text-navy font-semibold rounded-lg transition-all duration-200 text-sm",children:"Login to pmhnphiring.com"}),e.jsx("a",{href:_,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-text-secondary hover:text-teal transition-colors",children:"Don't have an account? Sign up free"})]}),r==="logged_in"&&(s==null?void 0:s.user)&&e.jsxs("div",{className:"flex-1 flex flex-col gap-3",children:[e.jsxs("p",{className:"text-base font-medium text-white",children:["Hi, ",s.user.firstName||"there","! ðŸ‘‹"]}),l&&e.jsxs("div",{className:"bg-navy-light rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Profile completeness"}),e.jsxs("span",{className:"text-xs font-semibold text-teal",children:[l.completeness,"%"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-navy-dark rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-teal rounded-full transition-all duration-500",style:{width:`${l.completeness}%`}})}),l.missing.length>0&&e.jsxs("p",{className:"text-[10px] text-text-muted mt-1.5",children:["Missing: ",l.missing.slice(0,3).join(", "),l.missing.length>3?` +${l.missing.length-3} more`:""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>chrome.tabs.create({url:N}),className:"flex-1 py-2 px-3 bg-navy-light hover:bg-navy-700 text-white text-xs font-medium rounded-lg transition-colors border border-border-color",children:"Profile Settings"}),e.jsx("button",{onClick:v,disabled:c,className:"flex-1 py-2 px-3 bg-navy-light hover:bg-navy-700 text-white text-xs font-medium rounded-lg transition-colors border border-border-color disabled:opacity-50",children:c?"Refreshing...":"Refresh Data"})]}),e.jsx("p",{className:"text-[11px] text-text-muted text-center",children:"Navigate to a job application to start autofilling"}),e.jsx("button",{onClick:j,className:"self-center text-[11px] text-text-muted hover:text-error transition-colors mt-auto",children:"Log out"})]}),r==="on_application"&&(s==null?void 0:s.user)&&e.jsxs("div",{className:"flex-1 flex flex-col gap-3",children:[e.jsxs("p",{className:"text-base font-medium text-white",children:["Hi, ",s.user.firstName||"there","! ðŸ‘‹"]}),l&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-navy-dark rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-teal rounded-full",style:{width:`${l.completeness}%`}})}),e.jsxs("span",{className:"text-xs text-teal font-medium",children:[l.completeness,"%"]})]}),i&&e.jsxs("div",{className:"bg-navy-light rounded-lg p-2.5 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-teal animate-pulse"}),e.jsx("span",{className:"text-xs text-text-secondary",children:i.atsName?`Detected: ${i.atsName} application`:"Unknown application form â€” using generic autofill"}),i.fieldCount>0&&e.jsxs("span",{className:"text-xs text-text-muted ml-auto",children:[i.fieldCount," fields"]})]}),e.jsx("button",{onClick:L,disabled:p,className:"w-full py-3 px-4 bg-teal hover:bg-teal-hover text-navy font-bold rounded-lg transition-all duration-200 text-sm flex items-center justify-center gap-2 disabled:opacity-70 shadow-lg shadow-teal/20",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-navy border-t-transparent"}),"Filling..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"âœ¨"}),"Autofill This Application"]})}),u&&e.jsx("p",{className:`text-xs text-center ${u.includes("failed")?"text-error":"text-success"}`,children:u}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:v,disabled:c,className:"flex-1 py-1.5 px-3 bg-navy-light text-white text-[11px] rounded-lg border border-border-color disabled:opacity-50",children:c?"...":"Refresh Data"}),e.jsx("button",{onClick:()=>chrome.tabs.create({url:N}),className:"flex-1 py-1.5 px-3 bg-navy-light text-white text-[11px] rounded-lg border border-border-color",children:"Settings"})]}),e.jsx("button",{onClick:j,className:"self-center text-[11px] text-text-muted hover:text-error transition-colors",children:"Log out"})]})]})}k.createRoot(document.getElementById("root")).render(e.jsx(R.StrictMode,{children:e.jsx(F,{})}));
