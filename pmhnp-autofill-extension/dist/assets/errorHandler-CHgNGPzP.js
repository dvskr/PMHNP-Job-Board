import{d as e,D as o,C as r}from"./constants-BdnQFqPF.js";async function g(){const a=(await chrome.storage.local.get(e.AUTH))[e.AUTH];return a?a.expiresAt&&new Date(a.expiresAt)<new Date?(await c(),{isLoggedIn:!1,user:null,token:null,expiresAt:null}):a:{isLoggedIn:!1,user:null,token:null,expiresAt:null}}async function E(t){await chrome.storage.local.set({[e.AUTH]:t})}async function c(){await chrome.storage.local.remove([e.AUTH])}async function A(){const t=await chrome.storage.local.get([e.PROFILE,e.PROFILE_CACHED_AT]),a=t[e.PROFILE],s=t[e.PROFILE_CACHED_AT];return!a||!s?null:{data:a,cachedAt:s}}async function f(t){await chrome.storage.local.set({[e.PROFILE]:t,[e.PROFILE_CACHED_AT]:Date.now()})}async function h(){await chrome.storage.local.remove([e.PROFILE,e.PROFILE_CACHED_AT])}async function m(){const a=(await chrome.storage.local.get(e.PROFILE_CACHED_AT))[e.PROFILE_CACHED_AT];return a?Date.now()-a>r:!0}async function R(){const a=(await chrome.storage.sync.get(e.SETTINGS))[e.SETTINGS];return{...o,...a}}async function l(){return(await chrome.storage.local.get(e.ERROR_LOG))[e.ERROR_LOG]||[]}async function i(t){const a=await l();a.push(t);const s=a.slice(-100);await chrome.storage.local.set({[e.ERROR_LOG]:s})}function T(t,a){const s=t instanceof Error?t.message:String(t),n=t instanceof Error?t.stack:void 0;console.error(`[PMHNP] Error in ${a}:`,t),i({timestamp:new Date().toISOString(),message:s,context:a,stack:n}).catch(()=>{})}export{g as a,c as b,T as c,h as d,A as e,f,R as g,m as i,E as s};
